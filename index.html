<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dojo de Kana - Pro</title>
    <!-- Fuentes Externas -->
    <link href="https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <!-- Hoja de Estilos Propia -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <header>
        <h1>Dojo de Escritura</h1>
        <p style="margin:5px; color:#666;">Selecciona ‚Ä¢ Escribe ‚Ä¢ Anima</p>
    </header>

    <!-- SETUP SCREEN -->
    <div id="setup-screen">
        <div class="toggle-group">
            <button class="toggle-btn active" id="btn-hira" onclick="Game.setMode('hiragana')">Hiragana („ÅÇ)</button>
            <button class="toggle-btn" id="btn-kata" onclick="Game.setMode('katakana')">Katakana („Ç¢)</button>
        </div>

        <h3 style="border-bottom:1px solid #eee; padding-bottom:5px;">1. Selecciona Filas</h3>
        
        <!-- Checkboxes con IDs para guardado autom√°tico -->
        <div class="checkbox-grid" id="rows-container">
            <label class="checkbox-item"><input type="checkbox" value="row-a" checked> Vocales</label>
            <label class="checkbox-item"><input type="checkbox" value="row-k" checked> K</label>
            <label class="checkbox-item"><input type="checkbox" value="row-s"> S</label>
            <label class="checkbox-item"><input type="checkbox" value="row-t"> T</label>
            <label class="checkbox-item"><input type="checkbox" value="row-n"> N</label>
            <label class="checkbox-item"><input type="checkbox" value="row-h"> H</label>
            <label class="checkbox-item"><input type="checkbox" value="row-m"> M</label>
            <label class="checkbox-item"><input type="checkbox" value="row-y"> Y</label>
            <label class="checkbox-item"><input type="checkbox" value="row-r"> R</label>
            <label class="checkbox-item"><input type="checkbox" value="row-w"> W/N</label>
            <label class="checkbox-item"><input type="checkbox" value="dakuten"> Sonoros</label>
        </div>

        <h3 style="border-bottom:1px solid #eee; padding-bottom:5px;">2. Configuraci√≥n</h3>
        
        <!-- Contrareloj -->
        <div class="challenge-box">
            <div>
                <strong>‚è±Ô∏è Modo Contrareloj</strong><br>
                <small style="color:#666">Retos progresivos</small>
            </div>
            <label class="switch">
                <input type="checkbox" id="time-mode-toggle">
                <span class="slider"></span>
            </label>
        </div>

        <!-- Toggle de Audio -->
        <div class="challenge-box">
            <div>
                <strong>üîä Audio de Pronunciaci√≥n</strong><br>
                <small style="color:#666">Escuchar al revelar respuesta</small>
            </div>
            <label class="switch">
                <input type="checkbox" id="audio-mode-toggle" checked>
                <span class="slider"></span>
            </label>
        </div>

        <!-- Toggle de Pizarra -->
        <div class="challenge-box blue">
            <div>
                <strong>‚úèÔ∏è Usar Pizarra Digital</strong><br>
                <small style="color:#666">Dibujar en pantalla (Desact√≠valo si usas papel)</small>
            </div>
            <label class="switch">
                <input type="checkbox" id="canvas-mode-toggle" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <button class="btn-main" id="btn-start">‚úèÔ∏è Empezar Pr√°ctica</button>
            <button class="btn-outline" onclick="generatePrintSheet()">üñ®Ô∏è Generar PDF</button>
        </div>
    </div>

    <!-- PRACTICE SCREEN -->
    <div id="practice-screen">
        
        <!-- Timer UI -->
        <div class="timer-container" id="timer-container">
            <div class="timer-bar" id="timer-bar"></div>
        </div>

        <div style="position:relative; width: 100%; text-align: center;">
            <div id="phase-badge" class="phase-badge">Nivel 1</div>
            
             <!-- Contenedor Romaji + Bot√≥n Audio -->
            <div style="display:flex; justify-content:center; align-items:center;">
                <div class="romaji-display" id="romaji-display">KA</div>
                <button id="manual-audio-btn" class="audio-btn" style="display:none;" onclick="Game.playCurrentAudio()">üîä</button>
            </div>
            
            <div id="timer-badge" class="stats-badge">15s</div>
        </div>

        <p id="instruction-text" style="color:#888; margin-top:-5px; font-size: 0.9rem;">Escribe en las zonas asignadas</p>

        <div class="toolbar" id="canvas-toolbar">
            <button class="tool-btn" onclick="CanvasManager.clear()">Borrar üóëÔ∏è</button>
            <span style="flex:1"></span>
            <!-- Info Stats -->
            <div style="display:flex; gap:15px; align-items:center; font-size:0.9rem; color:#666;">
                <span id="high-score-display">üèÜ Best: 0</span>
                <span id="counter" style="color:var(--dark); font-weight:bold;">Score: 0</span>
            </div>
        </div>
        
        <!-- Score alternativo cuando no hay canvas -->
        <div id="score-only" style="display:none; justify-content:center; gap:15px; color:#888; font-size:0.9rem; margin-bottom:10px;">
            <span id="high-score-display-alt">üèÜ Best: 0</span>
            <span id="counter-alt" style="color:var(--dark); font-weight:bold;">Score: 0</span>
        </div>

        <div class="workspace" id="workspace">
            <canvas id="writeCanvas" width="360" height="180"></canvas>
            <!-- Contenedor para m√∫ltiples SVGs -->
            <div id="svg-container"></div>
        </div>

        <!-- ACCIONES (MODIFICADO) -->
        
        <!-- 1. Estado inicial: Ver respuesta -->
        <div class="action-bar" id="default-actions">
            <button class="btn-outline" onclick="Game.exit()">Salir</button>
            <button class="btn-main" id="action-btn" onclick="Game.handleAction()" style="flex:2">Ver Respuesta</button>
        </div>

        <!-- 2. Estado evaluaci√≥n: Bien/Mal -->
        <div class="action-bar" id="evaluation-actions" style="display:none;">
            <button class="btn-outline" style="border-color:var(--danger); color:var(--danger);" onclick="Game.markResult(false)">‚ùå Mal</button>
            <button class="btn-outline" onclick="Game.replayAnimation()">‚Ü∫</button>
            <button class="btn-main" style="background:var(--secondary); border-color:var(--secondary);" onclick="Game.markResult(true)">‚úÖ Bien</button>
        </div>
    </div>

    <!-- PRINT CONTAINER -->
    <div id="print-container">
        <h2 class="print-title">Hoja de Pr√°ctica</h2>
        <div id="print-content"></div>
    </div>

    <!-- SCRIPTS -->
    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
